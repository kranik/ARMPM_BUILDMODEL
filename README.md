# Power model generation for ARM big.LITTLE aka _ARMPM\_BUILDMODEL_

**September 2017 - The code is no loger actively maintained, though I have some plans for a possuble update on the multi-thread model methodology.**

**March 2018 - I have officially graduated, so this project is currently closed.**

**February 2019 - Project reopened due to interested from other academic parties.**

Full details about the methodology and the produced models are presented in the dissertation [_Power Modelling and Analysis on Heterogeneous Embedded Systems_](https://seis.bristol.ac.uk/~eejlny/downloads/kris_thesis.pdf).

## Getting Started

The scripts contained in this repo represent the second part of the power modelling and analysis methodology, that I have developed as part of my PhD, namely the offline model generation and analysis. They work with the on-platform data gathered by the [_ARMPM\_DATACOLLECT_](https://github.com/kranik/ARMPM_DATACOLLECT) scripts. 

The whole model generation and validation process takes multiple steps:
1. Run the [_ARMPM\_DATACOLLECT_](https://github.com/kranik/ARMPM_DATACOLLECT) on the platform and obtain PMU event and power sensor samples from the platform.
2. Concatenate all the data files using timestamps from the samples using [`XU3_results.sh`](Scripts/XU3_results.sh).
3. Analyse the concatenated data files using [`octave_makemodel.sh`](Scripts/octave_makemodel.sh)

The [`octave_makemodel.sh`](Scripts/octave_makemodel.sh) script does both the model generation and validaton in a two-step process, but within the same code. All the scripts are written in bash, but use a lot of supporting linux commands to manipulate files and calculate model coefficients as well as using command line calls to [_Octave_](https://www.gnu.org/software/octave/) for more complex mathematical capabilities of the language.

This repo contains only the control scripts and does not include a version of octave, nor any example result files for analysis. This is done to minimize the repo size and also since github has a filesize limit (_though I might include some examples in the future_).

### Prerequisites

The script use `GNU bash, version 4.3.48(1)-release (x86_64-pc-linux-gnu)` and the platform is built on `Ubuntu 16.04.3 LTS (Xenial Xerus)`, kernel version `4.4.0-116-generic`. However the mothodology should be portable to other systems, since the scripts primarily use standart command line programs, such as `awk`, `sed`, `bc`, etc. and calls to `octave`. The project uses `GNU Octave, version 4.0.2` and should work with higher versions as well. Please check with your distro package database for the appropriate octave version or download and compile from [_here_](https://ftp.gnu.org/gnu/octave/).

**DISCLAIMER - I haven't really tested the scripts on other setups but my own so please let me know if you have any issues via [_email_](kris.nikov@bris.ac.uk).**

### Setup

Use `git clone git@github.com:kranik/ARMPM_DATACOLLECT.git` to clone the repo. Then install octave and make sure to update your `$PATH` to include the octave binary since the [`octave_makemodel.sh`](Scripts/octave_makemodel.sh) uses a call to `octave --silent --eval "load_build_model(...)"` to compute the models. Again these scripts are intended to work with the platform data generated by [_ARMPM\_DATACOLLECT_](https://github.com/kranik/ARMPM_DATACOLLECT) though if you provide files with the same format of the samples the scripts should still generate models. 

## Usage

After obtaining on-platform samples using the [_ARMPM\_DATACOLLECT_](https://github.com/kranik/ARMPM_DATACOLLECT) script/format the first step is to use the [`XU3_results.sh`](Scripts/XU3_results.sh) to analyse the data files with the power and PMU event samples and reformat the data for easy processing. That script uses calls to two supporting scripts [`process_raw_events.sh`](Scripts/process_raw_events.sh) and [`concatenate_results.sh`](Scripts/concatenate_results.sh), which in turn syncronize the power sensor and PMU event samples with the benchmark start and end date information to produce one large file in the following format:

```
#Timestamp	Benchmark	Run(#)	CPU(4) Frequency(MHz)	CPU(4) Temperature(C)	A15 Voltage(V)	A15 Current(A)	A15 Power(W)	CPU_CYCLES	L1I_CACHE_REFILL	L1I_TLB_REFILL	L1D_CACHE_ACCESS	L1D_TLB_REFILL	INST_RETIRED	EXCEPTION_TAKEN
1495799541911182792	parsec.dedup	1	1800	31	1.100000	0.469000	0.560000	545522980	5565229	1618872	122886684	1905462	242767835	27575
1495799542421250667	parsec.dedup	1	1800	32	1.100000	1.126000	1.348000	861434859	9003064	2606109	189346119	3058250	367420711	45310
1495799542931347334	parsec.dedup	1	1800	33	1.100000	1.129000	1.352000	873278984	8932811	2596105	197463907	3061025	391550539	45281
1495799543442541950	parsec.dedup	1	1800	33	1.100000	1.145000	1.371000	587130297	3463475	1858825	127304924	2161852	202394566	13916
...
```



<!---

give example for XU3_results.sh and octave_makemodel.sh and the wrap maybe

-->

### Troubleshooting

<!---

Use the -h options to troubleshooting

-->


## Contributing

<!---

compatible with the files generated by DATACOLLECT ; use of getops; that bash linter thing too

-->

## Versioning

<!---

since its just scripts I haven't bothered with versioning but might do this in the future if more contributors emerge

-->

## Author

The work presented here was carried out almost entirely by me (so far), [Dr Kris Nikov](kris.nikov@bris.ac.uk) as part of my PhD project in the Department of Electrical and Electronic Enginnering at the Univeristy of Bristol, UK. I have received some minor contrubutions such as the initial code for the OLS model fitting in octave, given to me by my academic supervisor [Dr Jose Nunez-Yanez](http://www.bristol.ac.uk/engineering/people/jose-l-nunez-yanez/overview.html). I have also used a kernel patch, provided by my industrial supervisor [Dr Matt Horsnell](https://uk.linkedin.com/in/matthorsnell), which enables the on-board PMU on the ODROID-XU3 development board.

## Licence

This project is licensed under the BSD-3 License - please see [LICENSE.md](LICENSE.md) for more details.

## Acknowledgements

The primary project supervisor was [Dr Jose Nunez-Yanez](http://www.bristol.ac.uk/engineering/people/jose-l-nunez-yanez/overview.html). This work was initially supported by [ARM Research](https://www.arm.com/resources/research) funding, through an EPSRC iCASE studentship and the [University of Bristol](http://www.bristol.ac.uk/doctoral-college/) and by the EPSRC ENEAC grant number EP/N002539/1. Industrial project supervisor was [Dr Matt Horsnell](https://uk.linkedin.com/in/matthorsnell)
